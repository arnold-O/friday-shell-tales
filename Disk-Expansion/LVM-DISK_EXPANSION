Extending Logical Volumes on Azure SAP Environment – Full Technical Breakdown

“Nothing ever goes as planned in the accurse world.”

This document provides a complete walkthrough of extending logical volumes (LVs) for a critical SAP environment running on Ubuntu in Azure, including commands, filesystem considerations, stripe/disk challenges, and lessons learned.

**Scenario Overview**

Customer: Client A
Environment: Azure VM, Ubuntu OS, SAP environment
Problem: Low disk space on multiple SAP data directories:

/sapenv_5

/sapenv_8

/sapenv_9

Objective: Extend storage without downtime, maintain system stability, and educate the client on LVM concepts.

The task looked simple on paper — just add space. But as always, things get interesting in real life.

**Initial Verification**

Before taking any action, we verified the current system setup:

Commands used:

vgdisplay    # Detailed info about volume groups (VG)
lvdisplay    # Detailed info about logical volumes (LV)
lvs          # Summary of logical volumes
vgs          # Summary of volume groups
lsblk        # List all block devices with details
df -h        # Disk usage of mounted filesystems


Additional checks:

Reviewed /etc/fstab to confirm all mount points were properly defined and would persist after reboot.

Ensured we understood the volume group, logical volume, and filesystem layout.

Outcome: Complete picture of VGs, LVs, mount points, and filesystem configuration achieved.

**Adding New Storage**

New disks were provisioned in Azure via the Azure portal.

One disk /dev/sdn was initialized and added to the existing volume group:

pvcreate /dev/sdn          # Initialize the disk as a physical volume
vgextend datavg /dev/sdn   # Add the PV to the datavg volume group

**Logical Volume Extensions**

Initial LV extensions:

lvextend -L +30G /dev/datavg/data5
lvextend -L +30G /dev/datavg/data8
lvextend -L +30G /dev/datavg/data9

**Expanding XFS Filesystems**

Because the volumes used XFS, we could expand the filesystems at the mount point online, with zero downtime:

xfs_growfs /sapenv_5
xfs_growfs /sapenv_8
xfs_growfs /sapenv_9


Key Point: XFS allows filesystem expansion at the mount point, unlike ext4 which often requires device-level resizing.

**Stripe vs Disk Challenge**

The logical volume /dev/datavg/data5 was originally created with 6 stripes for improved I/O performance:

Data is evenly distributed across 6 disks.

To preserve the 6-stripe layout, LVM requires free extents on all 6 disks simultaneously.

Problem: Client A had added only 4 new disks, not enough to satisfy the 6-stripe configuration.

Result: LVM failed with:

**Insufficient suitable allocatable extents for logical volume data5**

Options Explained to Client

Add 6 new disks → preserve original 6-stripe layout

Complex, more expensive

Mostly needed for I/O-intensive workloads

Single-stripe extension (-i1) → use available disks flexibly

Simple, safe, no downtime

Suitable because workload was mostly sequential writes on HDDs

Client agreed that the workload was not I/O intensive, so option 2 was selected.

**Implemented Solution**
lvextend -L +30G -i1 /dev/datavg/data5
xfs_growfs /sapenv_5


✅ Outcome:

Extension completed successfully

No downtime

System stability maintained

**LVM Education Moment**

During the session, we discovered that the virtual machine's OS disk was not LVM-based (Ubuntu standard partition layout).

Client initially requested: Add remaining LVM space to the root partition.

Explanation provided:

LVM can only expand logical volumes, not standard partitions.

Non-LVM partitions (like the root in Ubuntu) cannot directly consume LVM space.

Converting root partition to LVM is possible but risky in production.

Outcome: Client understood the limitation and safe alternatives.

**Concept Recap**
Concept	Explanation
PV (Physical Volume)	Actual disks or partitions (e.g., /dev/sdn)
VG (Volume Group)	Pool combining multiple PVs (e.g., datavg)
LV (Logical Volume)	Logical unit carved out from VG
Striping (-i)	Distributes data across multiple PVs for performance
XFS (xfs_growfs)	Expands filesystem at mount point online

**Command Reference**
Command	Description
lvextend -L +30G /dev/datavg/data5 ==	Extend LV by 30 GB
lvextend -L +30G /dev/datavg/data8 ==	Extend LV by 30 GB
lvextend -L +30G /dev/datavg/data9 ==	Extend LV by 30 GB
lvextend -L +30G -i1 /dev/datavg/data5 ==	Extend LV using single stripe
xfs_growfs /sapenv_5 ==	Expand XFS filesystem on /sapenv_5
xfs_growfs /sapenv_8 ==	Expand XFS filesystem on /sapenv_8
xfs_growfs /sapenv_9 ==	Expand XFS filesystem on /sapenv_9
pvcreate /dev/sdn ==	Initialize disk as PV
vgextend datavg /dev/sdn ==	Add PV to VG
lsblk ==	Show block devices
df -h ==	Disk usage of mounted filesystems
pvs ==	Show physical volumes
vgs ==	Show volume groups
lvs ==	Show logical volumes
lvdisplay / vgdisplay ==	Detailed info on LV/VG

**Key Takeaways**

Azure platform allows flexible disk provisioning and expansion.

XFS enables online filesystem expansion with no downtime.

Single-stripe extension is practical for non-I/O intensive workloads.

Understanding LVM vs non-LVM partitions is critical to set realistic expectations.

Always educate clients and stakeholders on storage architecture before making changes.

“Nothing ever goes as planned in the accurse world.”


Keep calm and sudo responsibly. bye for now

#Azure #Linux #LVM #XFS #SysAdmin #StorageManagement #SAP #ProblemSolving #LearningByDoing